name: Discover Uni-App Content

on:
  schedule:
    # Run every week on Monday at 10:00 AM UTC
    - cron: '0 10 * * 1'
  workflow_dispatch:  # Allow manual triggering

jobs:
  discover-and-submit:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Install dependencies
      run: |
        npm install axios cheerio
    
    - name: Run discovery script
      run: |
        node scripts/discover-content.js
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: 'Auto-discover: Add new uni-app content'
        title: 'ğŸ¤– è‡ªåŠ¨å‘ç°: æ–°å¢ä¼˜ç§€uni-appé¡¹ç›®å’Œæ–‡ç« '
        body: |
          ## è‡ªåŠ¨å‘ç°çš„uni-appå†…å®¹
          
          æœ¬PRæ˜¯é€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬å‘ç°çš„ä¼˜ç§€uni-appé¡¹ç›®ã€æ–‡ç« å’Œæ¡ˆä¾‹ã€‚
          
          ### å‘ç°å†…å®¹åŒ…æ‹¬:
          - ä¼˜ç§€çš„å¼€æºuni-appé¡¹ç›®
          - ç›¸å…³æŠ€æœ¯æ–‡ç« å’Œæ•™ç¨‹
          - å®ç”¨æ¡ˆä¾‹å’Œç¤ºä¾‹
          
          è¯·å®¡æ ¸åå†³å®šæ˜¯å¦åˆå¹¶åˆ°ä¸»åˆ†æ”¯ã€‚
          
          ---
          *æ­¤PRç”±è‡ªåŠ¨åŒ–å·¥å…·ç”Ÿæˆ*
        branch: auto-discovery/uni-app-content
        delete-branch: true